# Electron æ‰“åŒ…å®æ–½çŠ¶æ€

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. ä¾èµ–é…ç½®
- âœ… æ›´æ–°äº† `package.json`ï¼Œæ·»åŠ äº†å¿…è¦çš„å¼€å‘ä¾èµ–ï¼š
  - `electron-is-dev`: åŒºåˆ†å¼€å‘/ç”Ÿäº§ç¯å¢ƒ
  - `find-free-port`: åŠ¨æ€ç«¯å£åˆ†é…
  - `cross-env`: è·¨å¹³å°ç¯å¢ƒå˜é‡

### 2. å¯åŠ¨ç”»é¢
- âœ… åˆ›å»ºäº† `splash.html` - ç¾è§‚çš„å¯åŠ¨ç”»é¢
- âœ… åˆ›å»ºäº† `preload.js` - å®‰å…¨çš„ IPC é€šä¿¡

### 3. Electron ä¸»è¿›ç¨‹é‡æ„
- âœ… å®Œå…¨é‡å†™äº† `main.js`ï¼Œæ–°å¢åŠŸèƒ½ï¼š
  - åŠ¨æ€ç«¯å£æ£€æµ‹ï¼ˆ3000-3100èŒƒå›´ï¼‰
  - å¯åŠ¨è¿›åº¦æ˜¾ç¤º
  - ç”¨æˆ·æ•°æ®ç›®å½•ç®¡ç†ï¼ˆç¨‹åºç›®å½•ä¸‹çš„ userDataï¼‰
  - ä¼˜é›…çš„æœåŠ¡å™¨å¯åŠ¨å’Œå…³é—­
  - é”™è¯¯å¤„ç†

### 4. Next.js é…ç½®ä¼˜åŒ–
- âœ… é‡å†™äº† `next.config.ts`ï¼š
  - å…³é—­å›¾ç‰‡ä¼˜åŒ–ï¼ˆElectron ç¯å¢ƒå¿…éœ€ï¼‰
  - é…ç½® standalone è¾“å‡º
  - å¤„ç† Electron ç¯å¢ƒçš„ webpack é…ç½®
  - è®¾ç½®ç¯å¢ƒå˜é‡

### 5. è·¯å¾„å·¥å…·å‡½æ•°ï¼ˆç®€åŒ–çš„åŒè·¯å¾„ç­–ç•¥ï¼‰
- âœ… åˆ›å»ºäº† `src/utils/paths.ts`ï¼š
  - `getAppCachePath()` - ç³»ç»Ÿæ ‡å‡†ç¼“å­˜ä½ç½®ï¼ˆC:\Users\ç”¨æˆ·å\AppData\Local\AV-Managerï¼‰
  - `getUserDataPath()` - ç¨‹åºç›®å½•ç”¨æˆ·æ•°æ®
  - `getMovieCachePath()` - ç”µå½±ç¼“å­˜è·¯å¾„ï¼ˆç³»ç»Ÿç¼“å­˜ä½ç½®ï¼‰
  - `getRatingsPath()` - è¯„åˆ†æ•°æ®è·¯å¾„ï¼ˆç³»ç»Ÿç¼“å­˜ä½ç½®ï¼‰
  - `getConfigPath()` - é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆç¨‹åºç›®å½•ï¼‰
  - `getMovieDirectoryPath()` - ç”µå½±ç›®å½•é…ç½®ï¼ˆç¨‹åºç›®å½•ï¼‰

**ç®€åŒ–è®¾è®¡**ï¼š
- ğŸš« ç§»é™¤äº†ä¸å¿…è¦çš„ API è·¯ç”±
- âœ… ç›´æ¥é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’è·¯å¾„
- âœ… æœåŠ¡ç«¯ API ç›´æ¥ä½¿ç”¨è·¯å¾„å‡½æ•°

### 7. æ‰“åŒ…é…ç½®
- âœ… æ›´æ–°äº† `package.json` çš„ build é…ç½®ï¼š
  - ç²¾ç®€æ‰“åŒ…ç­–ç•¥
  - ä¾¿æºç‰ˆé…ç½®
  - æ’é™¤ä¸å¿…è¦æ–‡ä»¶
  - asarUnpack é…ç½®

### 8. ç¯å¢ƒé…ç½®
- âœ… åˆ›å»ºäº† `.env.local` - ç¯å¢ƒå˜é‡é…ç½®
- âœ… åˆ›å»ºäº† `userData` ç›®å½•ç»“æ„

## ğŸ“‹ æ¥ä¸‹æ¥éœ€è¦åšçš„æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–
```bash
npm install
```

### ç¬¬äºŒæ­¥ï¼šæ·»åŠ å›¾æ ‡
- å°†ä½ çš„å›¾æ ‡æ–‡ä»¶é‡å‘½åä¸º `icon.ico`
- æ”¾ç½®åˆ° `build/icon.ico` ä½ç½®

### ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•å¼€å‘ç¯å¢ƒ
```bash
# æµ‹è¯• Next.js æ˜¯å¦æ­£å¸¸
npm run dev

# æµ‹è¯• Electron å¼€å‘ç¯å¢ƒ
npm run electron:dev
```

### ç¬¬å››æ­¥ï¼šä¿®æ”¹ç°æœ‰ API è·¯ç”±ï¼ˆé‡è¦ï¼‰
éœ€è¦ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ä»¥ä½¿ç”¨æ–°çš„è·¯å¾„å‡½æ•°ï¼š

#### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼š
1. `src/app/api/movies/route.ts`
2. `src/app/api/movies/rating/route.ts`
3. `src/lib/movieMetadataCache.ts`
4. å…¶ä»–æ¶‰åŠæ–‡ä»¶æ“ä½œçš„ API

#### ä¿®æ”¹ç¤ºä¾‹ï¼š
```typescript
// åŸæ¥çš„ä»£ç 
const cacheFile = './movie-cache.json';

// ä¿®æ”¹ä¸ºï¼ˆç®€åŒ–ç‰ˆï¼‰
import { getMovieCachePath } from '@/utils/paths';
import path from 'path';

const cacheFile = path.join(getMovieCachePath(), 'movie-cache.json');

// ç¡®ä¿ç›®å½•å­˜åœ¨
import fs from 'fs';
const cacheDir = getMovieCachePath();
if (!fs.existsSync(cacheDir)) {
  fs.mkdirSync(cacheDir, { recursive: true });
}
```

### ç¬¬äº”æ­¥ï¼šæµ‹è¯•ç”Ÿäº§æ„å»º
```bash
# æ„å»º Next.js
npm run build

# æµ‹è¯•ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
npm run start

# æ‰“åŒ…æˆ exe
npm run dist
```

## ğŸ”§ å¯èƒ½é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šä¾èµ–å®‰è£…å¤±è´¥
**è§£å†³æ–¹æ¡ˆï¼š** æ¸…ç†ç¼“å­˜åé‡æ–°å®‰è£…
```bash
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

### é—®é¢˜2ï¼šElectron å¯åŠ¨å¤±è´¥
**è§£å†³æ–¹æ¡ˆï¼š** æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼ŒæŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### é—®é¢˜3ï¼šè·¯å¾„é—®é¢˜
**è§£å†³æ–¹æ¡ˆï¼š** ç¡®ä¿æ‰€æœ‰æ–‡ä»¶æ“ä½œéƒ½ä½¿ç”¨æ–°çš„è·¯å¾„å‡½æ•°

### é—®é¢˜4ï¼šæ‰“åŒ…å¤±è´¥
**è§£å†³æ–¹æ¡ˆï¼š** 
- ç¡®ä¿ `build/icon.ico` å­˜åœ¨
- æ£€æŸ¥ `.next` ç›®å½•æ˜¯å¦æ­£ç¡®ç”Ÿæˆ
- æŸ¥çœ‹ electron-builder æ—¥å¿—

## ğŸ“Š é¢„æœŸç»“æœ

æˆåŠŸåä½ å°†å¾—åˆ°ï¼š
- `dist/AV-Manager-Portable.exe` - ä¾¿æºç‰ˆå¯æ‰§è¡Œæ–‡ä»¶
- å¯åŠ¨æ—¶é—´ï¼š< 8ç§’
- å®‰è£…åŒ…å¤§å°ï¼š< 200MB

### ğŸ“ æ•°æ®å­˜å‚¨ç­–ç•¥ï¼š
- **é…ç½®æ–‡ä»¶**ï¼šç¨‹åºç›®å½•çš„ `userData` æ–‡ä»¶å¤¹ï¼ˆä¾¿æºæ€§ï¼‰
- **ç¼“å­˜æ•°æ®**ï¼šç³»ç»Ÿæ ‡å‡†ä½ç½® `C:\Users\ç”¨æˆ·å\AppData\Local\AV-Manager`
  - ç”µå½±ç¼“å­˜ï¼š`movie-cache` å­ç›®å½•
  - è¯„åˆ†æ•°æ®ï¼š`ratings` å­ç›®å½•

### ğŸ¯ ä¼˜åŠ¿ï¼š
- âœ… ç¬¦åˆ Windows åº”ç”¨è§„èŒƒ
- âœ… ä¾¿äºç³»ç»Ÿæ¸…ç†å’Œç®¡ç†
- âœ… å¤šç”¨æˆ·ç¯å¢ƒæ”¯æŒ
- âœ… ç¨‹åºä»å¯ä¾¿æºä½¿ç”¨

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³æ‰§è¡Œ**ï¼šå®‰è£…ä¾èµ–å’Œæ·»åŠ å›¾æ ‡
2. **æµ‹è¯•é˜¶æ®µ**ï¼šéªŒè¯å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒ
3. **ä¿®æ”¹é˜¶æ®µ**ï¼šæ›´æ–°ç°æœ‰ API è·¯ç”±ä½¿ç”¨æ–°è·¯å¾„
4. **æ‰“åŒ…é˜¶æ®µ**ï¼šç”Ÿæˆæœ€ç»ˆçš„ exe æ–‡ä»¶

ä½ å‡†å¤‡å¥½å¼€å§‹äº†å—ï¼Ÿæˆ‘å»ºè®®å…ˆä»å®‰è£…ä¾èµ–å’Œæ·»åŠ å›¾æ ‡å¼€å§‹ï¼